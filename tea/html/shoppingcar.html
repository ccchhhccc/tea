<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/style.css"/>
		<link rel="stylesheet" type="text/css" href="../css/shoppingcar.css"/>
	</head>
	<body>
		<div class="header">
			<img src="../img/toppic.png"/>
		</div>
		<div class="title">
			<div class="thead">
				<a href="#">免费注册</a>
				<a href="#">登录</a>
				<span class="phone">服务热线：400-8899-379</span>
				<img src="../img/wx.png" class="wx"/>
				<i class="order">我的订单</i>
				<img src="../img/order.png" class="orderimg"/>
			</div>
		</div>
		<div class="wrap">
			<div class="main">
				<img class="logo" src="../img/logo.png" id="logo" />
				<img class="gif" src="../img/brand.gif"/>
				<div class="jindu">
					<div class="greenxian"></div>
					<div class="xian"></div>
					<div class="radius first">1</div>
					<div class="radius second">2</div>
					<div class="radius third">3</div>
					<span class="first1">1、我的购物车</span>
					<span class="second2">2、填写核对订单信息</span>
					<span class="third3">3、成功提交订单</span>
				</div>
			</div>
		</div>
		<div class="nav">
			<ul>
				<li><a href="#">全部分类</a>
					<div class="selectl" id="selectl">
						<ul>
							<li>
								<img src="../img/header_ico1.png"/>
								<a href="#">茶饮机</a>
								<span class="r">></span>
							</li>
							<li>
								<img src="../img/header_ico2.png"/>
								<a href="#">专用茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico3.png"/>
								<a href="#">绿茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico4.png"/>
								<a href="#">红茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico5.png"/>
								<a href="#">乌龙茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico6.png"/>
								<a href="#">花果茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico7.png"/>
								<a href="#">黑茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico8.png"/>
								<a href="#">白茶</a>
								<span>></span>
							</li>
							<li>
								<img src="../img/header_ico9.png"/>
								<a href="#">茶具</a>
								<span>></span>
							</li>
						</ul>
					</div>
				</li>
				<li><a href="#">智能茶饮机</a></li>
				<li><a href="#">茶饮机专用茶</a></li>
				<li><a href="#">自饮茶</a></li>
				<li><a href="#">礼品茶</a></li>
				<li><a href="#">招商</a></li>
				<li><a href="#">服务热线：400-8899-379</a></li>
			</ul>
		</div>
		<div class="tiao"></div>
		<div class="cartitle">
			<h3>我的购物车</h3>
			<i>结算</i>
			<em>￥437.00</em>
			<span>已选商品（不含运费）</span>
		</div>
		<div class="allchoose">
			<span>选择</span>
			<span>单价（元）</span>
			<span>优惠（元）</span>
			<span>数量</span>
			<span>金额（元）</span>
			<span>操作</span>
		</div>
		<div class="total">
			<input type="checkbox" id="all"/>
			<i class="shcar"></i>
			<span>商铺：主站</span>
		</div>
		<div class="ku">
			<div class="changku">MH总仓库</div>
		</div>

		<div id="contents">
			<!-- <div class="carlist">
				<input type="checkbox" class="choose"/>
				<img  />
				<span class="doogstitle">【远荣】一级清盘铁观音（梅）盒装250/g（买一送一）</span>
				<div class="price">
					<span>152.00</span>
					<em>152.00</em>
				</div>
				<div class="hui">
					<span>33.00</span>
					<i>7.8折</i>
				</div>
				
				<div class="remove">X</div>
				<b class="nowprice">119.00</b>
				<div class="updown">
					<i class="up"></i>
					<i class="down"></i>
				</div>
				<input type="text" class="num" value="1"/>
			</div>
			<div class="carlist">
				<input type="checkbox" class="choose"/>
				<img  />
				<span class="doogstitle">【远荣】一级清盘铁观音（梅）盒装250/g（买一送一）</span>
				<div class="price">
					<span>152.00</span>
					<em>152.00</em>
				</div>
				<div class="hui">
					<span>33.00</span>
					<i>7.8折</i>
				</div>
				
				<div class="remove">X</div>
				<b class="nowprice">119.00</b>
				<div class="updown">
					<i class="up"></i>
					<i class="down"></i>
				</div>
				<input type="text" class="num" value="1"/>
			</div>  -->
		</div>
		<div class="gift">
			<i></i>
			<span>赠品</span>
		</div>
		<div class="giftlist">
			<img  />
			<span class="doogstitle">【远荣】一级清盘铁观音（梅）盒装250/g（买一送一）</span>
			<em>152.00</em>
			<span class="none">--</span>
			<span class="giftnum">1</span>
			<b class="giftprice">0</b>
		</div>
		<div class="jifen">
			<div class="jifenlogo">
				<h3>874</h3>
				<span class="logonum">和茶网积分</span>
			</div>
			<span class="totalnum">874积分<span>
		</div>
		<div class="carfoot">
			<input type="checkbox" id="allcheck"/>
			<span>全选</span>
			<a><i>X</i>删除全部</a>
			<b>￥437.00</b>
			<em>商品总价（不含运费）:</em>
		</div>
		<div class="btns">
			<a class="back"><span><</span>继续购物</a>
			<a class="topay">去结算<span>></span></a>
		</div>
		<!--<div class="bg"></div>-->
		<div class="footer">
			<ul>
				<li>
					<img src="../img/f1.png" />
				</li>
				<li>
					<img src="../img/f2.png" />
				</li>
				<li>
					<img src="../img/f3.png" />
				</li>
				<li>
					<img src="../img/f4.png" />
				</li>
			</ul>
			<img  src="../img/footer.jpg" class="foot"/>
		</div>
	</body>
</html>
<script src='../js/ajax.js'></script>
<script src='../js/cookie.js'></script>
<script>
var strcookie = getCookie("init");
if(strcookie==null||strcookie==''){
	var json = null;
}else {
	var json = JSON.parse(strcookie);
}
var info = [];
ajax('get','../json/product.json','',function(data){
	for(var id in json){
		for(var i in data){
			for(var key in data[i]){
				for(var y in data[i][key]){
					if(data[i][key][y].id==id){
						info.push(data[i][key][y]) ;
						break;
					}
				}
			}
		}
	}
	var contents = document.getElementById('contents');
	for(var i = 0 ; i<info.length ; i++){
		var oldprice = getPrice(info[i].activeprice);
		var nowprice = getPrice(info[i].hechaprice);
		var off = (oldprice - nowprice).toFixed(2);
		var hui = parseInt(oldprice/nowprice*100)/10;
		for(var key in json){
			if(key==info[i].id)
				var num = json[key];
		}
		var tprice = (nowprice*num).toFixed(2);
		str = `<div class="carlist">
				<input type="checkbox" class="choose"/>
				<img  src='${info[i].showimg[0]}'/>
				<span class="doogstitle">${info[i].title}</span>
				<div class="price">
					<span>${oldprice}</span>
					<em>${nowprice}</em>
				</div>
				<div class="hui">
					<span>${off}</span>
					<i>${hui}折</i>
				</div>
				
				<div class="remove" data-id='${info[i].id}'>X</div>
				<b class="nowprice">${tprice}</b>
				<div class="updown" data-id='${info[i].id}'>
					<i class="up"></i>
					<i class="down"></i>
				</div>
				<input type="text" class="num" value="${num}"/>
			</div>`;
		contents.innerHTML += str;
	}
	var allcheckbox = document.getElementById('all');
	var bottomallcheck = document.getElementById('allcheck');
	var carlist = document.querySelectorAll('.carlist');
	var checkboxs = document.querySelectorAll('.choose');
	bottomallcheck.onclick = allcheckbox.onclick = function(){
		if(this.checked==true){
			for(var i in checkboxs){
				checkboxs[i].checked = true;
			}
			bottomallcheck.checked = true;
			allcheckbox.checked = true;
		}else{
			for(var i in checkboxs){
				checkboxs[i].checked = false;
			}
			bottomallcheck.checked = false;
			allcheckbox.checked = false;
		}
		updateTotalPrice();
		
	}
	for(var i in checkboxs){
		checkboxs[i].onclick = function(){
			if(this.checked){
				var flag = true;
				for(var i in checkboxs){
					if(checkboxs[i].checked==false){
						flag = false;
						break;
					}
				}
				if(flag){
					allcheckbox.checked = true;
					bottomallcheck.checked = true;
				}
			}else{
				allcheckbox.checked = false;
				bottomallcheck.checked = false;
			}
			updateTotalPrice();
		}
	}
	allcheckbox.checked = true;
	bottomallcheck.checked = true;
	for(var i = 0 ; i<checkboxs.length ; i++){
		checkboxs[i].checked = true;
	}
	var numup = document.querySelectorAll('.up');
	var numdown = document.querySelectorAll('.down');
	for(var i in numup){
		numup[i].index = i ;
		numup[i].onclick = function(){
			var num = ++this.parentNode.nextElementSibling.value;
			computeTotalPrice(this,num);
			var id = this.parentNode.getAttribute('data-id');
			json = changeCookie(id,num);
			updateTotalPrice();
			console.log(json)
		}
	}
	for(var i in numdown){
		numdown[i].index = i ;
		numdown[i].onclick = function(){
			if(this.parentNode.nextElementSibling.value>=2){
				var num = --this.parentNode.nextElementSibling.value;
				computeTotalPrice(this,num);
				var id = this.parentNode.getAttribute('data-id');
				json = changeCookie(id,num);
				updateTotalPrice();
				console.log(json)
			}
		}
	}
	function computeTotalPrice(obj,num){
		var signprice = carlist[obj.index].querySelector('em');
		var nowsignprice = signprice.innerHTML*parseFloat(carlist[obj.index].querySelector('i').innerHTML)/10;
		var total = parseInt(nowsignprice*num*100)/100;
		var off = parseInt((signprice.innerHTML*num - total)*100)/100;
		carlist[obj.index].querySelector('.hui').querySelector('span').innerHTML = off;
		carlist[obj.index].querySelector('.nowprice').innerHTML = total;
	}

	var removes = document.querySelectorAll('.remove');
	for(var i in removes){
		removes[i].onclick = function(){
			if(document.querySelectorAll('.remove').length==1){
				document.querySelector('.gift').remove();
				document.querySelector('.giftlist').remove();
				document.querySelector('.jifen').remove();
			}
			var id = this.getAttribute('data-id');
			json = changeCookie(id,0);
			this.parentNode.remove();
			updateTotalPrice();
			console.log(json)
		}
	}
	var removeAll = document.querySelector('.carfoot>a');
	removeAll.onclick = function(){
		var list = document.querySelectorAll('.carlist');
		for(var i = 0 ; i<list.length; i++){
			list[i].remove();
		}
		document.querySelector('.gift').remove();
		document.querySelector('.giftlist').remove();
		document.querySelector('.jifen').remove();
		allcheckbox.checked = false;
		bottomallcheck.checked = false;
		updateTotalPrice();
		json = {};
		setCookie('init','',7);
	}
	// <div class="jifenlogo">
	// 				<h3>874</h3>
	// 				<span class="logonum">和茶网积分</span>
	// 			</div>
	// 			<span class="totalnum">874积分<span>
	function updateTotalPrice(){
		var list = document.querySelectorAll('.carlist');
		//console.log(list)
		var total = 0 ;
		for(var i=0 ; i<list.length ; i++){
			if(list[i].querySelector('.choose').checked){
				total += parseInt(parseFloat(list[i].querySelector('.nowprice').innerHTML)*100)/100;
			}
		}
		document.querySelector('.cartitle>em').innerHTML = '￥'+total;
		document.querySelector('.carfoot>b').innerHTML = '￥'+total;
		if(document.querySelector('.jifenlogo>h3'))
			document.querySelector('.jifenlogo>h3').innerHTML = Math.ceil(total);
		if(document.querySelector('.totalnum'))
			document.querySelector('.totalnum').innerHTML = Math.ceil(total)+'积分';
	}
	updateTotalPrice();

	var logo = document.getElementById('logo');
	logo.onclick = function(){
		location.href = '../index1.html';
	}
	
})


function getPrice(num){
	return num.slice(1);
}
function changeCookie(id,num){
	for(var key in json){
		if(key==id){
			if(num==0){
				delete json[key];
			}else{
				json[key] = num;
			}
		}
	}
	setCookie('init',JSON.stringify(json),7)
	return JSON.parse(getCookie('init'));
}
</script>